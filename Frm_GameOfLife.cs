/*
 
⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣦⡀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣷⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⢀⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⣼⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣠⣤⣤⣼⣿⣿⣿⣿⣿⣿⣿⣿⣷⠀⠀⠀⠀⠀
⠀⠀⠀⢀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀
⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀
⠀⠀⠀⠘⣿⣿⣿⣿⠟⠁⠀⠀⠀⠹⣿⣿⣿⣿⣿⠟⠁⠀⠀⠹⣿⣿⡿⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣿⣿⣿⡇⠀⠀⠀⢼⣿⠀⢿⣿⣿⣿⣿⠀⣾⣷⠀⠀⢿⣿⣷⠀⠀⠀⠀⠀
⠀⠀⠀⢠⣿⣿⣿⣷⡀⠀⠀⠈⠋⢀⣿⣿⣿⣿⣿⡀⠙⠋⠀⢀⣾⣿⣿⠀⠀⠀⠀⠀
⢀⣀⣀⣀⣿⣿⣿⣿⣿⣶⣶⣶⣶⣿⣿⣿⣿⣾⣿⣷⣦⣤⣴⣿⣿⣿⣿⣤⠤⢤⣤⡄
⠈⠉⠉⢉⣙⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⣀⣀⣀⡀⠀
⠐⠚⠋⠉⢀⣬⡿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣥⣀⡀⠈⠀⠈⠛
⠀⠀⠴⠚⠉⠀⠀⠀⠉⠛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠋⠁⠀⠀⠀⠉⠛⠢⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀

Federico Zuffa
16.01.2026
Classe Passerelle
Projet Game of Life V1

*/
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;


namespace Projet_GameOfLife
{
    public partial class Frm_GameOfLife : Form
    {
        private const int WINDOW_WIDTH = 1000;
        private const int WINDOW_HEIGHT = 800;
        private const int WINDOW_MARGIN = 200;
        


        private Grid _grid;
        private int _lastRow = -1;
        private int _lastCol = -1;
        private bool _isMouseDown = false;
        private int _speedInterval;
        internal Grid Grid { get => _grid; set => _grid = value; }
        public int LastRow { get => _lastRow; set => _lastRow = value; }
        public int LastCol { get => _lastCol; set => _lastCol = value; }
        public bool IsMouseDown { get => _isMouseDown; set => _isMouseDown = value; }
        public int SpeedInterval { get => _speedInterval; set => _speedInterval = value; }

        public Frm_GameOfLife()
        {
            InitializeComponent();
            SpeedInterval = 500;
        }


        private void Frm_GameOfLife_Load(object sender, EventArgs e)
        {
            Grid = new Grid(10, 20); //100 row, 100 col

            // TEST TEST TEST TEST TEST                 

            SpeedInterval = trckBr_Speed.Value;
            timer1.Interval = SpeedInterval; //1 seconde de base
            pictureBox1.Width = WINDOW_WIDTH - WINDOW_MARGIN;
            pictureBox1.Height = WINDOW_HEIGHT - WINDOW_MARGIN;
            this.Size = new Size(WINDOW_WIDTH, WINDOW_HEIGHT);

            Grid.CellSize = Math.Min((int)(pictureBox1.Width / Grid.NbColumn), (int)(pictureBox1.Height / Grid.NbRow));

            Grid.InitializeBitMap(pictureBox1.Width, pictureBox1.Height);

            //TEST Planneur

            //Grid.SetCellState(1, 2, true);
            //Grid.SetCellState(2, 3, true);
            //Grid.SetCellState(3, 1, true);
            //Grid.SetCellState(3, 2, true);
            //Grid.SetCellState(3, 3, true);

            // TEST HELICE

            //Grid.SetCellState(1, 4, true);
            //Grid.SetCellState(1, 5, true);
            //Grid.SetCellState(1, 6, true);
            //Grid.SetCellState(1, 5, true);
            //Grid.SetCellState(2, 3, true);
            //Grid.SetCellState(2, 5, true);
            //Grid.SetCellState(3, 1, true);
            //Grid.SetCellState(3, 2, true);
            //Grid.SetCellState(3, 3, true);
            //Grid.SetCellState(3, 4, true);
            //Grid.SetCellState(3, 5, true);
            //Grid.SetCellState(4, 1, true);
            //Grid.SetCellState(4, 3, true);
            //Grid.SetCellState(5, 1, true);
            //Grid.SetCellState(5, 3, true);
            //Grid.SetCellState(5, 4, true);
            //Grid.SetCellState(5, 5, true);





            Grid.Display();
            pictureBox1.Image = Grid.Bitmap;
        }

        private void btn_Step_Click(object sender, EventArgs e)
        {
            Grid.Step(new Rules());
            Grid.Display();
            pictureBox1.Refresh();
        }  
        private void btn_RESET_Click(object sender, EventArgs e)
        {
            Grid.ClearDisplay();
            pictureBox1.Refresh();
        }

        private void pictureBox1_MouseDown(object sender, MouseEventArgs e)
        {
            IsMouseDown = true;
            MouseDraw(e);
        }

        private void pictureBox1_MouseMove(object sender, MouseEventArgs e)
        {
            if (IsMouseDown)
            {
                MouseDraw(e);
            }
        }
        private void pictureBox1_MouseUp(object sender, MouseEventArgs e)
        {
            IsMouseDown = false;
            LastRow = -1;
            LastCol = -1;
        }


        private void MouseDraw(MouseEventArgs e)
        {
            if (Grid.IsCellInGrid(e.X, e.Y))
            {
                int[] cells = Grid.GetCellFromPixel(e.X, e.Y);
                int currentRow = cells[0];
                int currentCol = cells[1];
                if (currentRow != LastRow || currentCol != LastCol)
                {
                    if (e.Button == MouseButtons.Left)
                    {
                        Grid.SetCellState(currentRow, currentCol, true);
                    }
                    if (e.Button == MouseButtons.Right)
                    {
                        Grid.SetCellState(currentRow, currentCol, false);
                    }
                    LastRow = currentRow;
                    LastCol = currentCol;

                    Grid.Display();
                    pictureBox1.Refresh();
                }
            }
        }

        private void btn_START_Click(object sender, EventArgs e)
        {
            if (btn_START.Text == "START")
            {
                timer1.Start();
                btn_START.Text = "STOP";
            }
            else { 
                timer1.Stop();
                btn_START.Text = "START";
            }
        }

        private void timer1_Tick(object sender, EventArgs e)
        {
            Grid.Step(new Rules());
            Grid.Display();
            pictureBox1.Refresh();
            //insérer le trckbar.value pour modifier en temps réel
        }
    }
}
