/*
 
⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣦⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣴⣿⣦⡀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣆⠀⠀⠀⠀⠀⠀⠀⠀⣾⣿⣿⣿⣷⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢀⣾⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣿⡆⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⢀⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⣼⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣠⣤⣤⣼⣿⣿⣿⣿⣿⣿⣿⣿⣷⠀⠀⠀⠀⠀
⠀⠀⠀⢀⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀
⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠀⠀⠀⠀⠀
⠀⠀⠀⠘⣿⣿⣿⣿⠟⠁⠀⠀⠀⠹⣿⣿⣿⣿⣿⠟⠁⠀⠀⠹⣿⣿⡿⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣿⣿⣿⡇⠀⠀⠀⢼⣿⠀⢿⣿⣿⣿⣿⠀⣾⣷⠀⠀⢿⣿⣷⠀⠀⠀⠀⠀
⠀⠀⠀⢠⣿⣿⣿⣷⡀⠀⠀⠈⠋⢀⣿⣿⣿⣿⣿⡀⠙⠋⠀⢀⣾⣿⣿⠀⠀⠀⠀⠀
⢀⣀⣀⣀⣿⣿⣿⣿⣿⣶⣶⣶⣶⣿⣿⣿⣿⣾⣿⣷⣦⣤⣴⣿⣿⣿⣿⣤⠤⢤⣤⡄
⠈⠉⠉⢉⣙⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⣀⣀⣀⡀⠀
⠐⠚⠋⠉⢀⣬⡿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣥⣀⡀⠈⠀⠈⠛
⠀⠀⠴⠚⠉⠀⠀⠀⠉⠛⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠛⠋⠁⠀⠀⠀⠉⠛⠢⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⢠⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠀⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⠀⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡄⠀⠀⠀⠀⠀⠀⠀⠀
⠀⠀⠀⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀

Federico Zuffa
16.01.2026
Classe Passerelle
Projet Game of Life V1

*/
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;


namespace Projet_GameOfLife
{
    public partial class Frm_GameOfLife : Form
    {
        private const int WINDOW_WIDTH = 1200;
        private const int WINDOW_HEIGHT = 900;
        private const int WINDOW_MARGIN = 10;


        private Grid _grid;
        private int _lastRow = -1;
        private int _lastCol = -1;
        private bool _isMouseDown = false;
        internal Grid Grid { get => _grid; set => _grid = value; }
        public int LastRow { get => _lastRow; set => _lastRow = value; }
        public int LastCol { get => _lastCol; set => _lastCol = value; }
        public bool IsMouseDown { get => _isMouseDown; set => _isMouseDown = value; }

        public Frm_GameOfLife()
        {
            InitializeComponent();
        }


        private void Frm_GameOfLife_Load(object sender, EventArgs e)
        {
            Grid = new Grid(10, 20); //100 row, 100 col, cell de 20px
            pictureBox1.Width = WINDOW_WIDTH - WINDOW_MARGIN;
            pictureBox1.Height = WINDOW_HEIGHT - WINDOW_MARGIN;

            Grid.CellSize = Math.Min(pictureBox1.Width / Grid.NbColumn, pictureBox1.Height / Grid.NbRow);

            Grid.InitializeBitMap(pictureBox1.Width, pictureBox1.Height);

            //TEST Planneur

            //Grid.SetCellState(1, 2, true);
            //Grid.SetCellState(2, 3, true);
            //Grid.SetCellState(3, 1, true);
            //Grid.SetCellState(3, 2, true);
            //Grid.SetCellState(3, 3, true);

            // TEST HELICE

            //Grid.SetCellState(1, 4, true);
            //Grid.SetCellState(1, 5, true);
            //Grid.SetCellState(1, 6, true);
            //Grid.SetCellState(1, 5, true);
            //Grid.SetCellState(2, 3, true);
            //Grid.SetCellState(2, 5, true);
            //Grid.SetCellState(3, 1, true);
            //Grid.SetCellState(3, 2, true);
            //Grid.SetCellState(3, 3, true);
            //Grid.SetCellState(3, 4, true);
            //Grid.SetCellState(3, 5, true);
            //Grid.SetCellState(4, 1, true);
            //Grid.SetCellState(4, 3, true);
            //Grid.SetCellState(5, 1, true);
            //Grid.SetCellState(5, 3, true);
            //Grid.SetCellState(5, 4, true);
            //Grid.SetCellState(5, 5, true);





            Grid.Display();
            pictureBox1.Image = Grid.Bitmap;
        }

        private void btn_Step_Click(object sender, EventArgs e)
        {
            Grid.Step(new Rules());
            Grid.Display();
            pictureBox1.Refresh();
        }
        private void btn_previousStep_Click(object sender, EventArgs e)
        {
            
        }
        private void btn_RESET_Click(object sender, EventArgs e)
        {
            Grid.ClearDisplay();
            pictureBox1.Refresh();
        }

        private void pictureBox1_MouseClick(object sender, MouseEventArgs e)
        {
            Grid.ToggleFromPixel(e.X, e.Y);
            Grid.Display();
            pictureBox1.Refresh();
        }

        private void pictureBox1_MouseDown(object sender, MouseEventArgs e)
        {
            IsMouseDown = true;
            MouseDraw(e);
        }

        private void pictureBox1_MouseMove(object sender, MouseEventArgs e)
        {
            if (IsMouseDown)
            {
                MouseDraw(e);
            }
        }
        private void pictureBox1_MouseUp(object sender, MouseEventArgs e)
        {
            IsMouseDown = false;
            LastRow = -1;
            LastCol = -1;
        }


        private void MouseDraw(MouseEventArgs e)
        {
            if (Grid.IsCellInGrid(e.X, e.Y))
            {
                int[] cells = Grid.GetCellFromPixel(e.X, e.Y);
                int currentRow = cells[0];
                int currentCol = cells[1];
                if (currentRow != LastRow || currentCol != LastCol)
                {
                    if (e.Button == MouseButtons.Left)
                    {
                        Grid.SetCellState(currentRow, currentCol, true);
                    }
                    if (e.Button == MouseButtons.Right)
                    {
                        Grid.SetCellState(currentRow, currentCol, false);
                    }
                    LastRow = currentRow;
                    LastCol = currentCol;

                    Grid.Display();
                    pictureBox1.Refresh();
                }
            }
        }

        private void btn_START_Click(object sender, EventArgs e)
        {

        }
    }
}
